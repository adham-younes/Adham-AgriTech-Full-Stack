# دليل مبسّط لرفع صلاحيات النشر

> يساعدك هذا الدليل على تجهيز البيئة بأبسط صورة ممكنة حتى تتمكن سكربتات النشر الآلي من العمل فورًا.

## 1. تجهيز ملف البيئة
1. انسخ الملف `.env.publish.example` إلى `.env.publish`.
2. عبّئ القيم المطلوبة:
   - `VERCEL_TOKEN` مع صلاحية **deploy** أو **manage**.
   - `VERCEL_PROJECT_ID` أو `VERCEL_PROJECT` (اسم أو معرّف المشروع داخل Vercel).
   - (اختياري) `VERCEL_TEAM_ID` إذا كان المشروع ضمن فريق.
   - (اختياري) `VERCEL_PROTECTION_BYPASS_SECRET` عند تفعيل حماية النشر.
   - `GIT_REMOTE_URL` بعنوان المستودع الذي تريد الدفع إليه.
3. احتفظ بالملف محليًا أو داخل مدير أسرار آمن؛ لا تدفعه إلى Git.

## 2. اختبار الاتصال بالمستودع
1. نفّذ `pnpm git:sync --dry-run` للتأكد من قراءة المتغيرات.
2. إذا ظهرت النتائج صحيحة، شغّل `pnpm git:sync` لإضافة الريموت ودفع الفرع الحالي.
3. استخدم `git remote -v` للتأكد من نجاح الربط.

## 3. ربط المشروع مع Vercel
1. شغّل `vercel link` وحدد الفريق والمشروع الصحيحين.
2. نفّذ `vercel pull --yes` لسحب إعدادات البيئة المحلية من Vercel.
3. إذا ظهرت أخطاء مصادقة، حدّث `VERCEL_TOKEN` أو نفّذ `vercel login`.

## 4. فحص الجاهزية
1. شغّل `pnpm vercel:check` للتحقق من أن كل المتطلبات متوفرة.
2. أصلح أي عنصر يحمل علامة ❌ (رمز ناقص، ريموت غير مضبوط، معرّف خاطئ...).
3. أعد الفحص حتى تحصل على تقرير سليم بالكامل.

## 5. تشغيل النشر الآلي
1. استخدم `pnpm vercel:emergency --skip-build` لتشغيل المسار الكامل (مزامنة + فحص + نشر مباشر).
2. أضف خيار `--dry-run` إذا أردت معاينة الأوامر بدون تنفيذ فعلي.
3. لإجراء بناء يدوي قبل النشر، نفّذ `pnpm build` ثم `pnpm vercel:deploy`.

## 6. مراقبة ما بعد النشر
1. استعمل `pnpm vercel:status --prod --wait 120` لمتابعة حالة آخر نشر.
2. زر صفحة [غرفة التحكم في النشر](/ops/deployments) لمشاهدة القياسات الحية.
3. عند وجود حماية نشر، اختبر الوصول عبر الرأس `x-vercel-protection-bypass` باستخدام السر المخصص.

## 7. نقاط سريعة للمشكلات الشائعة
- **رمز Vercel مفقود أو منتهي**: أنشئ رمزًا جديدًا وأعد تشغيل الفحص.
- **المشروع غير مرتبط**: أعد تنفيذ `vercel link` ثم `vercel pull`.
- **لا يوجد ريموت Git**: اضبط `GIT_REMOTE_URL` أو أضف الريموت يدويًا ثم ادفع الفرع.
- **حماية النشر تمنع الوصول**: عرّف `VERCEL_PROTECTION_BYPASS_SECRET` ومرّره في الاختبارات المؤتمتة.

بعد تنفيذ هذه الخطوات تكون الصلاحيات مفعّلة وجميع السكربتات جاهزة لتحديث المستودع والنطاق بشكل مؤتمت.
