# قائمة التفعيل السريع للنشر الآلي

هذه الصفحة تلخص أقل عدد من الخطوات العملية التي يجب القيام بها قبل أن تتمكن سكربتات النشر من العمل بكامل الصلاحيات. استخدمها كمرجع سريع عندما تريد إعادة توصيل المنصة بالمستودع والنطاق.

## 1. تجهيز ملف البيئة الخاصة بالنشر

1. انسخ الملف `.env.publish.example` إلى `.env.publish`.
2. عبّئ القيم الإلزامية التالية:
   - `VERCEL_TOKEN`: رمز وصول بصلاحيات **deploy** أو **manage** للمشروع.
   - `VERCEL_PROJECT_ID` أو `VERCEL_PROJECT`: معرّف المشروع داخل Vercel.
   - `GIT_REMOTE_URL`: رابط المستودع البعيد (HTTPS أو SSH) حتى يتمكن السكربت من إضافة الريموت.
3. أضف (عند الحاجة) القيم الاختيارية:
   - `VERCEL_TEAM_ID`: إذا كان المشروع ضمن فريق محدد.
   - `VERCEL_PROTECTION_BYPASS_SECRET`: سر تجاوز حماية النشر للمشاريع المحمية.
   - `GIT_REMOTE_NAME`, `GIT_BRANCH`, `GIT_SET_UPSTREAM`: عندما ترغب بتغيير الأسماء الافتراضية.
4. خزّن الملف في مدير أسرار آمن ولا ترفعه إلى Git.

## 2. تهيئة الاتصال بالمستودع

1. شغّل `pnpm git:sync --dry-run` للتأكد من أن السكربت قرأ القيم الصحيحة.
2. عند التأكد من النتائج، شغّل `pnpm git:sync` لإضافة الريموت ودفع الفرع الحالي.
3. استخدم `git remote -v` للتحقق من أن الربط نجح.

## 3. ربط المشروع مع Vercel

1. نفّذ `vercel link` مرة واحدة لاختيار الفريق والمشروع المناسبين.
2. شغّل `vercel pull --yes` لجلب إعدادات البيئة وتثبيت ملف `.vercel/project.json`.
3. إذا ظهرت رسائل خطأ حول الرموز، راجع `VERCEL_TOKEN` وتأكد أنه صالح وغير منتهي.

## 4. فحص الجاهزية التلقائي

1. شغّل `pnpm vercel:check`.
2. عالج أي عنصر يظهر بعلامة ❌. يشير ذلك إلى نقص يمنع النشر (رمز مفقود، معرّف غير مضبوط، ريموت غير موجود... إلخ).
3. أعد تشغيل الفحص حتى تظهر النتائج بدون أخطاء حمراء.

## 5. تشغيل النشر الآلي

1. بعد نجاح الفحص، شغّل `pnpm vercel:emergency --skip-build` للحصول على مسار آلي كامل (مزامنة + فحص + نشر مباشر).
2. استخدم `--dry-run` عندما تريد التأكد من الأوامر دون تنفيذ فعلي.
3. في حال رغبت بالبناء قبل النشر، احذف خيار `--skip-build` أو قم بتشغيل `pnpm build` يدويًا ثم `pnpm vercel:deploy`.

## 6. التحقق والمراقبة

1. استخدم `pnpm vercel:status --prod --wait 120` لمراقبة آخر نشر.
2. افتح صفحة لوحة التحكم [غرفة التحكم في النشر](/ops/deployments) لمتابعة القياسات الحية.
3. عند تفعيل حماية النشر، جرّب الطلب باستخدام الرأس `x-vercel-protection-bypass` مع السر المحدد للتأكد من الوصول.

## 7. خطة الاستجابة السريعة

| المشكلة | الإجراء السريع |
| --- | --- |
| `VERCEL_TOKEN` غير صالح | أنشئ رمزًا جديدًا من لوحة التحكم وأعد تصديره في الجلسة الحالية. |
| المشروع غير مرتبط | أعد تشغيل `vercel link` ثم `vercel pull`. |
| الريموت غير موجود | أعد تشغيل `pnpm git:sync` أو `git remote add` يدويًا ثم `git push`. |
| حماية النشر تمنع الوصول | تأكد من ضبط `VERCEL_PROTECTION_BYPASS_SECRET` وتمريره كمتغير بيئة. |
| فشل البناء | شغّل `pnpm lint` و`pnpm build` محليًا، أصلح الأخطاء ثم أعد النشر. |

## ملاحظات ختامية

- لا يتم منح أي صلاحية إضافية بدون توفير هذه المتغيرات يدويًا من طرفك؛ السكربتات هنا فقط لتسهيل التنفيذ عندما تتوفر الرموز.
- احرص على تحديث الوثائق الداخلية إذا تم تغيير أسماء المشاريع أو مفاتيح الحماية حتى لا تتكرر الأعطال مستقبلًا.
