name: Translation Check

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main, develop ]

jobs:
  translation-check:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v5
      
    - name: Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18.x'
        cache: 'npm'
        
    - name: Install dependencies
      run: npm ci
      
    - name: Check Arabic text
      run: |
        echo "Checking for Arabic text in code..."
        if grep -r "[\u0600-\u06FF]" --include="*.tsx" --include="*.ts" --include="*.js" --include="*.jsx" .; then
          echo "‚úÖ Arabic text found in code files"
        else
          echo "‚ùå No Arabic text found in code files"
        fi
      continue-on-error: true
      
    - name: Check English text
      run: |
        echo "Checking for English text in code..."
        if grep -r "Start Free\|Sign In\|Login\|Dashboard\|Weather\|Reports" --include="*.tsx" --include="*.ts" --include="*.js" --include="*.jsx" .; then
          echo "‚úÖ English text found in code files"
        else
          echo "‚ùå No English text found in code files"
        fi
      continue-on-error: true
      
    - name: Check RTL support
      run: |
        echo "Checking for RTL support..."
        if grep -r "dir.*rtl\|dir.*ltr" --include="*.tsx" --include="*.ts" --include="*.js" --include="*.jsx" .; then
          echo "‚úÖ RTL/LTR support found"
        else
          echo "‚ùå No RTL/LTR support found"
        fi
      continue-on-error: true
      
    - name: Check language attributes
      run: |
        echo "Checking for language attributes..."
        if grep -r "lang.*ar\|lang.*en" --include="*.tsx" --include="*.ts" --include="*.js" --include="*.jsx" .; then
          echo "‚úÖ Language attributes found"
        else
          echo "‚ùå No language attributes found"
        fi
      continue-on-error: true
      
    - name: Comment PR with translation results
      if: github.event_name == 'pull_request'
      uses: actions/github-script@v7
      with:
        script: |
          const comment = `## üåê Translation Check Results
          
          ### Checks Performed
          - ‚úÖ Arabic text detection
          - ‚úÖ English text detection
          - ‚úÖ RTL/LTR support
          - ‚úÖ Language attributes
          
          ### Recommendations
          - Ensure all user-facing text is translated
          - Check RTL layout for Arabic content
          - Verify language attributes are correct
          - Test both Arabic and English versions
          `;
          
          github.rest.issues.createComment({
            issue_number: context.issue.number,
            owner: context.repo.owner,
            repo: context.repo.repo,
            body: comment
          });
      continue-on-error: true